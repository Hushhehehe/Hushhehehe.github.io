<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>妇女节贺卡</title>
    <script src="./jquery.js"></script>
    <script type="text/javascript" src="./55ac9ea30001ace700000000.js"></script>
  </head>
  <body>
    <!-- 飘花 -->
    <!-- <div id="flower-container">
      <div id="snowflake"></div>
    </div> -->
    <div class="container">
      
      <div class="card">
        <div class="first-page">
          啊啊啊啊啊啊啊啊啊啊啊啊啊啊
          <div id="wei1">wei1</div>
          <div type="button" onclick="alertInfo(1)">打开1</div>
          <div id="btn" type="button" class="btn-change btn-blue" onclick="changePage(2)">点开惊喜</div>
          <!-- <div id="btn" type="button" class="btn-change btn-white" onclick="changePage(2)">点开惊喜</div> -->
        </div>
        <div class="second-page">
          <div class="rongqi">
            <div class="wish-div">
              <div id="girl-name">XXX</div>
              <div class="text-content">在这美好的日子里祝你节日快乐，工作顺利。</div>
              <div class="text-content">在这美好的日子里祝你节日快乐，工作顺利。</div>
            </div>
          <div id="wei2">wei2</div>
          <div type="button" onclick="alertInfo(2)">打开2</div>
          <div id="btn" type="button" class="btn-change btn-blue" onclick="changePage(1)">返回封面</div>
            <div class="button-div">
            <!-- <div id="btn" type="button" class="btn" onclick="receiveRedBag(1)">返回封面</div> -->
              <button id="btn" type="button" class="btn" onclick="receiveRedBag()">开</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="play-btn">
      <!-- <img src="./music.png"  alt="音乐" /> -->
    </div>
    <audio id="mp3" src="./music.mp3" autoplay loop="loop" ></audio>

    
  </body>
  <script type="text/javascript">
    var openId = ''
    var firstClick = false
    getOpenIdAndInfo()
    snowflake()
    musicPlay()
    function getOpenIdAndInfo() {
      let url = location.href
      console.log('url: ' + url)
      openId = url.split('=')[1]
      console.log('openId: ' + openId)
      let xhr = new XMLHttpRequest()//第一步：新建对象
      xhr.open('GET', `http://k12.nlapp.top/infoByOpenid/${openId}`, true);//第二步：打开连接  将请求参数写在url中 
      xhr.send();//第三步：发送请求  将请求参数写在URL中
      xhr.onreadystatechange = function () {
          if (xhr.readyState == 4 && xhr.status == 200) {
            let res = JSON.parse(xhr.responseText)
            console.log(res)
            if (res.code === 0) {
              document.getElementById('girl-name').innerHTML = '某某某'
            } else {
              alert('获取员工信息失败，错误信息：' + res.msg)
              document.getElementById('btn').removeAttribute('disabled')
            }
          }
      };
    }
    function alertInfo(num) {
      document.getElementById('wei1').innerHTML = '打开' + num
      document.getElementById('wei2').innerHTML = '打开' + num
      alert('打开' + num)
    }
    function changePage(page) {
      // 翻到第二页
      if (page === 2) {
        document.getElementsByClassName('card')[0].style.transform = 'rotateY(180deg)'
      } else {
        document.getElementsByClassName('card')[0].style.transform = 'rotateY(0)'
      }
    }
    function receiveRedBag() {
      console.log('openId: ' + openId)
      document.getElementById('btn').setAttribute('disabled', 'disabled')
      console.log('发送领红包请求')
      const obj = {
        openid: openId,
        award: 0.01,
        sendName: '开门红余额返还',
        wishing: '测试',
        actName: '测试',
        remark: '测试'
      }
      let httpRequest = new XMLHttpRequest();//第一步：创建需要的对象
      // httpRequest.open('POST', 'url', true); //第二步：打开连接
      httpRequest.open('POST', 'http://k12.nlapp.top/xmax/func/sendhb', true); //第二步：打开连接
      httpRequest.setRequestHeader("Content-type","application/json");//设置请求头 注：post方式必须设置请求头（在建立连接后设置请求头）
      httpRequest.send(JSON.stringify(obj))
      httpRequest.onreadystatechange = function () {
        if (httpRequest.readyState == 4 && httpRequest.status == 200) {
          let res = JSON.parse(httpRequest.responseText)
          console.log(res)
          if (res.code === 0) {
            alert('红包已发送至公众号，请前往公众号领取')
          } else {
            alert('错误信息：' + res.msg)
            document.getElementById('btn').removeAttribute('disabled')
          }
        }
      }
    }
    var snowflakeURl = [
      './flower1.png',
      './flower2.png',
      './flower3.png',
      './flower4.png',
      './flower5.png',
      './flower6.png'
    ]
    /*
    **飘雪花
    */
    // function snowflake() {
    //   // 雪花容器
    //   var $flakeContainer = $('#snowflake');
    //   // 随机六张图
    //   function getImagesName() {
    //     return snowflakeURl[[Math.floor(Math.random() * 6)]];
    //   }
    //   // 创建一个雪花元素
    //   function createSnowBox() {
    //     var url = getImagesName();
    //     return $('<div class="snowbox" />').css({
    //       'width': 20,
    //       'height': 20,
    //       'position': 'absolute',
    //       'backgroundSize': 'cover',
    //       'zIndex': 10,
    //       'top': '-41px',
    //       'backgroundImage': 'url(' + url + ')'
    //     }).addClass('snowRoll');
    //   }
    //   // 开始飘花
    //   setInterval(function() {
    //     // 运动的轨迹
    //     var startPositionLeft = Math.random() * document.getElementById('flower-container').clientWidth - 100,
    //       startOpacity    = 1,
    //       endPositionTop  = document.getElementById('flower-container').clientHeight,
    //       endPositionLeft = startPositionLeft - 100 + Math.random() * 500,
    //       duration        = document.getElementById('flower-container').clientHeight * 20 + Math.random() * 2500;
    //     // 随机透明度，不小于0.5
    //     var randomStart = Math.random();
    //     randomStart = randomStart < 0.5 ? startOpacity : randomStart;
    //     // 创建一个雪花
    //     var $flake = createSnowBox();
    //     // 设计起点位置
    //     $flake.css({
    //       left: startPositionLeft,
    //       opacity : randomStart
    //     });
    //     // 加入到容器
    //     $flakeContainer.append($flake);
    //     // 开始执行动画
    //     $flake.transition({
    //       top: endPositionTop,
    //       left: endPositionLeft,
    //       opacity: 0.7
    //     }, duration, 'ease-out', function() {
    //       $(this).remove() //结束后删除
    //     });
    //   }, 200);
    // }
    // 音乐播放控制
    function musicPlay() {
          let mp3 = document.querySelector('#mp3')
          let playBtn = document.querySelector('#play-btn')
          let play
          mp3.load()
          document.addEventListener("click", function () {
            if (!firstClick) {
              mp3.play()
              firstClick = true
              playBtn.style.animationPlayState = 'running'
              if (!mp3.paused) {
                playBtn.style.animationPlayState = 'running'
                mp3.play()
                firstClick = true
                play = true
              }
            }
          }, false)

          play = !mp3.paused && mp3.readyState === 4
          if (play) {
            playBtn.style.animationPlayState = 'running'
          } else {
            playBtn.style.animationPlayState = 'paused'
          }
          playBtn.addEventListener('click', function (event) {
            if (play) {
              this.style.animationPlayState = 'paused'
              mp3.pause()
              play = false
            } else {
              if (mp3.readyState === 4) {
                this.style.animationPlayState = 'running'
                mp3.play()
                play = true
              }
            }
          })
        }

  </script>

  <style>
    html{
      font-size: 18px;
    }
    @media screen and (max-width: 350px){
      html {
          font-size: 16px !important;
      }
    }
    @media screen and (min-width: 351px) and (max-width: 700px) {
      html {
          font-size: 18px !important;
      }
    }
    body{
      margin: 0;
      height: 100%;
      -webkit-overflow-scrolling: touch;
    }
    a{ text-decoration:none;}
    a:link {color: #000}
    a:visited {color: #000}
    #flower-container{
      height: 100%;
      width: 100%;
      overflow: hidden;
      position: absolute;
    }
    .container{
      height: 100vh;
      width: 100vw;
      position: relative;
      perspective:1000;transform-style:preserve-3d;
    }
    .card{
      position: relative;
      transition:1s;transform-style:preserve-3d;
    }
    .first-page, .second-page{
      height: 100vh;
      width: 100vw;
      -webkit-overflow-scrolling: touch;
      position: absolute;
      backface-visibility:hidden;
      background-size: 100% 100%;
    }
    .first-page{
      z-index: 2;
      background-image: url('./background1.jpg');
    }
    .second-page{
      background-image: url('./background2.png');
      transform:rotateY(-180deg);
    }
    .btn-white{
      color: white;
      border: 2px solid white;
      animation: animated-border-white 1.5s infinite;
    }
    .btn-blue{
      color: #6986a5;
      border: 2px solid #6986a5;
      animation: animated-border-blue 1.5s infinite;
    }
    .btn-change{
      width: 100px;
      height: 30px;
      line-height: 30px;
      text-align: center;
      position: absolute;
      bottom: 30px;
      right:30px;
      border-radius: 10px;
    }
    @keyframes animated-border-white{
      0%{
        box-shadow: 0 0 0 0 rgba(255,255,255,0.7);
      }
      100%{
        box-shadow: 0 0 0 5px rgba(255,255,255,0);
      }
    }
    @keyframes animated-border-blue{
      0%{
        box-shadow: 0 0 0 0 rgba(105,134,165,0.7);
      }
      100%{
        box-shadow: 0 0 0 5px rgba(105,134,165,0);
      }
    }
    /* .container:active .card{transform:rotateY(180deg);} */
    .rongqi{
      padding-top: 65%;
    }
    .wish-div{
      margin: 0 auto;
      width: 60%;
      /* height: 300px; */
      background-color: #fff;
      opacity: 0.6;
      border-radius: 4px;
      padding: 20px;
      font-weight: bold;
      line-height: 2rem;
    }
    #girl-name{
    }
    .text-content{
      text-indent: 40px;
    }
    .button-div{
      /* margin-top: 50px; */
    }
    .btn{
      outline: 0;
      font-weight: bold;
      width: 3em;
      height: 3em;
      color: #fff;
      border: none;
      display: block;
      font-size: 1.5em;
      cursor: pointer;
      margin: 2rem auto;
      background-color: #ffd955;
      border-radius: 100%;
      transition: background-color 1s, transform 1.5s;
    }
    .btn:active{
      transform: scale(1.3);
      background-color: #ffc600;
    }
    #play-btn {
      position: absolute;
      top: 16px;
      right: 20px;
      z-index: 30;
      width: 34px;
      height: 34px;
      text-align: center;
      border-radius: 50%;
      -webkit-transition-duration: 1s;
      -webkit-animation: rotate 3s linear infinite;
      animation: rotate 3s linear infinite;
      animation-play-state: paused;
      color: #efefef;
      box-shadow: 1px 2px 2px #777;
      background-image: url('./music.png');
      background-size: contain;
    }
    #play-btn img{
      width: 30px;
      height: 30px;
    }
    @-webkit-keyframes rotate { 
      from {
        -webkit-transform: rotate(0deg)
      }
      to {
        -webkit-transform: rotate(360deg)
      }
    }
    @keyframes rotate{
      from {
        transform: rotate(0deg)
      }
      to {
        transform: rotate(359deg)
      }
    }
  </style>
</html>
